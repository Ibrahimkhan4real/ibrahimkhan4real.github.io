<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Muhammad Ibrahim Khan">
  <meta name="description" content="Research publications by Muhammad Ibrahim Khan.">
  <title>Publications — Muhammad Ibrahim Khan</title>
  <link rel="icon" href="/assets/img/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/assets/css/site.css">
</head>
<body>
  <aside>
    <div id="user_meta">
      <div id="author_info">
        <a href="/"><img src="/assets/img/Khan_logo.jpg" alt="Muhammad Ibrahim Khan logo" width="192" height="192"></a>
        <h2><a href="/">Muhammad Ibrahim Khan</a></h2>
        <p class="subtitle">AI Engineer · Applied Researcher</p>
      </div>
      <ul>
        <li><a class="nav-link" href="/index.html">home</a></li>
        <li><a class="nav-link" href="/live.html">live</a></li>
        <li><a class="nav-link current" href="/papers.html">papers</a></li>
        <li><a class="nav-link" href="/index.html#projects">projects</a></li>
        <li><a class="nav-link" href="/index.html#contact">contact</a></li>
        <li><a class="nav-link" href="https://github.com/Ibrahimkhan4real" target="_blank" rel="noopener noreferrer">github</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>Updated automatically from Google Scholar</p>
    </header>

    <article>
      <div id="article_title">
        <h1>Research Publications</h1>
      </div>
      <div id="article_text">
        <p class="lead">This page pulls directly from my Google Scholar profile, so the newest publications appear without manual edits. Run <code>python scripts/update_papers.py --scholar-id bh9os08AAAAJ</code> whenever you want to refresh the list locally.</p>

        <ul id="papers-list"></ul>
        <p id="status">Loading publications…</p>
      </div>
    </article>

    <div id="ending_message">
      <p>&copy; <span id="current-year"></span> Muhammad Ibrahim Khan. Data source: Google Scholar.</p>
    </div>
  </main>

  <script>
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("papers-list");
    const yearEl = document.getElementById("current-year");

    function renderPublication(pub) {
      const item = document.createElement("li");
      item.className = "status-card paper-card";

      const title = document.createElement("h3");
      if (pub.link) {
        const anchor = document.createElement("a");
        anchor.href = pub.link;
        anchor.textContent = pub.title || "Untitled";
        anchor.target = "_blank";
        anchor.rel = "noopener noreferrer";
        title.appendChild(anchor);
      } else {
        title.textContent = pub.title || "Untitled";
      }
      item.appendChild(title);

      if (pub.authors) {
        const authors = document.createElement("p");
        authors.className = "paper-authors";
        authors.textContent = pub.authors;
        item.appendChild(authors);
      }

      const meta = [];
      if (pub.venue) meta.push(pub.venue);
      if (pub.year) meta.push(pub.year);
      if (pub.citations) {
        const trimmed = pub.citations.replace(/\u2013|\u2014/g, "").trim();
        if (trimmed) meta.push(`${trimmed} citations`);
      }

      if (meta.length) {
        const metaEl = document.createElement("p");
        metaEl.className = "paper-meta";
        metaEl.textContent = meta.join(" · ");
        item.appendChild(metaEl);
      }

      return item;
    }

    async function loadPublications() {
      try {
        const response = await fetch(`/site_data/papers.json?cachebust=${Date.now()}`);
        if (!response.ok) {
          throw new Error(`Request failed with status ${response.status}`);
        }
        const payload = await response.json();
        const publications = Array.isArray(payload.publications) ? payload.publications : [];
        const sorted = publications.slice().sort((a, b) => {
          const yearA = parseInt(a.year || "0", 10);
          const yearB = parseInt(b.year || "0", 10);
          if (Number.isNaN(yearA) && Number.isNaN(yearB)) return 0;
          if (Number.isNaN(yearA)) return 1;
          if (Number.isNaN(yearB)) return -1;
          return yearB - yearA;
        });
        if (!sorted.length) {
          statusEl.textContent = "No publications found. Run the update script to fetch the latest data.";
          return;
        }
        sorted.forEach(pub => listEl.appendChild(renderPublication(pub)));
        statusEl.textContent = `Last updated ${payload.generated_at || "recently"} from Google Scholar (${payload.count || sorted.length} items).`;
      } catch (error) {
        statusEl.textContent = "Could not load publications automatically. Please run the update script or check your network connection.";
        console.error(error);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      yearEl.textContent = new Date().getFullYear();
      loadPublications();
    });
  </script>
</body>
</html>
